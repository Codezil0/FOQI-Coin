<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8" />
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
ย ย <title>FOQI Coin | $FOQI Airdrop</title>

ย ย ย ย <link rel="icon" type="image/x-icon" href="favicon.ico?v=2">

ย ย ย ย <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>

ย ย ย ย <style>
ย ย ย ย @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

ย ย ย ย :root {
ย ย ย ย ย ย /* Colores del Tema Oscuro y Elegante */
ย ย ย ย ย ย --primary-color: #38a169; /* Verde (Para รฉxito y acentos sutiles) */
ย ย ย ย ย ย --secondary-color: #4299e1; /* Celeste Oscuro/Vivo (Acento principal) */
ย ย ย ย ย ย --background-dark: #1f2937; /* Fondo Gris Oscuro */
ย ย ย ย ย ย --card-background: #2d3748; /* Fondo de Tarjeta mรกs claro que el body (Gris Azulado Oscuro) */
ย ย ย ย ย ย --text-light: #f7fafc; /* Texto Principal Blanco */
ย ย ย ย ย ย --text-muted: #9ca3af; /* Texto Secundario/Gris Claro */
ย ย ย ย ย ย --error-color: #ef4444; /* Rojo para Errores */
ย ย ย ย ย ย --success-color: #10b981; /* Verde para รxito */
ย ย ย ย ย ย --gray-accent: #5e6b7d; /* Nuevo color para el botรณn de MetaMask */
ย ย ย ย }

ย ย ย ย /* Base */
ย ย ย ย * {
ย ย ย ย ย ย box-sizing: border-box;
ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย padding: 0;
ย ย ย ย }

ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Poppins', sans-serif;
ย ย ย ย ย ย /* Degradado de Fondo Oscuro: casi negro */
ย ย ย ย ย ย background: linear-gradient(135deg, #10172a 0%, var(--background-dark) 100%);ย
ย ย ย ย ย ย color: var(--text-light);ย
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;ย
ย ย ย ย ย ย min-height: 100vh;
ย ย ย ย ย ย padding: 20px 0;
ย ย ย ย }

ย ย ย ย /* Contenedor Principal (Tarjeta) */
ย ย ย ย .container {
ย ย ย ย ย ย width: 90%;
ย ย ย ย ย ย max-width: 450px;
ย ย ย ย ย ย padding: 30px;
ย ย ย ย ย ย /* Degradado de fondo gris oscuro transparente */
ย ย ย ย ย ย background: linear-gradient(145deg, var(--card-background) 0%, #374151 100%);
ย ย ย ย ย ย border-radius: 20px;
ย ย ย ย ย ย /* Sombra profunda */
ย ย ย ย ย ย box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), 0 5px 15px rgba(0, 0, 0, 0.3);ย
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย gap: 25px;
ย ย ย ย ย ย text-align: center;ย
ย ย ย ย ย ย border: 1px solid #374151; /* Borde suave */
ย ย ย ย }

ย ย ย ย /* Header */
ย ย ย ย .header {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย /* Usamos el color de acento celeste */
ย ย ย ย ย ย border-bottom: 2px solid var(--secondary-color);
ย ย ย ย ย ย padding-bottom: 20px;
ย ย ย ย }

ย ย ย ย .logo-container {
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย }

ย ย ย ย .logo {
ย ย ย ย ย ย /* TAMAรO DE LOGO: 220px */
ย ย ย ย ย ย width: 220px;ย
ย ย ย ย ย ย height: 220px;
ย ย ย ย ย ย border-radius: 50%;
ย ย ย ย ย ย object-fit: cover;
ย ย ย ย ย ย border: none;ย
ย ย ย ย ย ย /* Sombra elegante para destacarlo en el tema oscuro */
ย ย ย ย ย ย box-shadow: 0 0 20px rgba(66, 153, 225, 0.4);ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Ajuste de logo para mรณviles */
ย ย ย ย @media (max-width: 500px) {
ย ย ย ย ย ย .logo {
ย ย ย ย ย ย ย ย width: 150px;
ย ย ย ย ย ย ย ย height: 150px;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย .header h1 {
ย ย ย ย ย ย font-size: 2rem;
ย ย ย ย ย ย font-weight: 700;
ย ย ย ย }

ย ย ย ย .token-symbol {
ย ย ย ย ย ย color: var(--secondary-color);ย
ย ย ย ย }

ย ย ย ย .slogan {
ย ย ย ย ย ย color: var(--text-muted);
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย font-weight: 400;
ย ย ย ย }

ย ย ย ย /* Secciones Generales */
ย ย ย ย .section {
ย ย ย ย ย ย background-color: #374151; /* Gris medio oscuro */
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย border-radius: 15px;
ย ย ย ย ย ย box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);ย
ย ย ย ย ย ย text-align: center;ย
ย ย ย ย }

ย ย ย ย .section h2 {
ย ย ย ย ย ย font-size: 1.35rem;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย color: var(--secondary-color);ย
ย ย ย ย ย ย /* Lรญnea de acento con el celeste oscuro */
ย ย ย ย ย ย border-bottom: 2px solid var(--secondary-color);ย
ย ย ย ย ย ย padding-bottom: 8px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย }

ย ย ย ย .section h3 {
ย ย ย ย ย ย ยcolor: var(--primary-color);
ย ย ย ย ย ย ยfont-size: 1.2rem;
ย ย ย ย ย ย ยfont-weight: 700;
ย ย ย ย ย ย ยmargin-bottom: 10px;
ย ย ย ย }

ย ย ย ย /* Botones */
ย ย ย ย .connect-button, .airdrop-button, .add-token-button {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย padding: 14px 25px;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย font-size: 1.1rem;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย transition: all 0.2s ease-in-out;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย ย ย box-shadow: 0 4px 0 rgba(0, 0, 0, 0.4);ย
ย ย ย ย }

ย ย ย ย /* Botรณn de Conexiรณn (Celeste) */
ย ย ย ย .connect-button {
ย ย ย ย ย ย background-color: var(--secondary-color);
ย ย ย ย ย ย color: var(--card-background); /* Texto oscuro para contraste */
ย ย ย ย ย ย box-shadow: 0 4px 0 #2a6f9c;ย
ย ย ย ย }

ย ย ย ย .connect-button:hover:not(:disabled) {
ย ย ย ย ย ย background-color: #55b0f4;ย
ย ย ย ย ย ย transform: translateY(-1px);
ย ย ย ย ย ย box-shadow: 0 5px 0 #2a6f9c;ย
ย ย ย ย }

ย ย ย ย .connect-button:active:not(:disabled) {
ย ย ย ย ย ย transform: translateY(4px);
ย ย ย ย ย ย box-shadow: 0 0 0 #2a6f9c;ย
ย ย ย ย }

ย ย ย ย /* Botรณn de Airdrop (Verde - Acciรณn) */
ย ย ย ย .airdrop-button {
ย ย ย ย ย ย background-color: var(--primary-color);
ย ย ย ย ย ย color: var(--card-background);ย
ย ย ย ย ย ย box-shadow: 0 4px 0 #2f855a;ย
ย ย ย ย }

ย ย ย ย .airdrop-button:hover:not(:disabled) {
ย ย ย ย ย ย background-color: #48bb78;ย
ย ย ย ย ย ย transform: translateY(-1px);
ย ย ย ย ย ย box-shadow: 0 5px 0 #2f855a;ย
ย ย ย ย }

ย ย ย ย .airdrop-button:active:not(:disabled) {
ย ย ย ย ย ย transform: translateY(4px);
ย ย ย ย ย ย box-shadow: 0 0 0 #2f855a;ย
ย ย ย ย }

ย ย ย ย .airdrop-button.disabled {
ย ย ย ย ย ย background-color: #4b5563;
ย ย ย ย ย ย color: #6b7280;
ย ย ย ย ย ย cursor: not-allowed;
ย ย ย ย ย ย box-shadow: 0 4px #374151;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Nuevo Botรณn de Agregar Token (Gris/Plomo) */
ย ย ย ย .add-token-button {
ย ย ย ย ย ย background-color: var(--gray-accent);ย
ย ย ย ย ย ย color: var(--text-light);ย
ย ย ย ย ย ย box-shadow: 0 4px 0 #4a5568;ย
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย padding: 12px 25px;
ย ย ย ย }

ย ย ย ย .add-token-button:hover:not(:disabled) {
ย ย ย ย ย ย background-color: #6c788a;ย
ย ย ย ย ย ย transform: translateY(-1px);
ย ย ย ย ย ย box-shadow: 0 5px 0 #4a5568;ย
ย ย ย ย }

ย ย ย ย .add-token-button:active:not(:disabled) {
ย ย ย ย ย ย transform: translateY(4px);
ย ย ย ย ย ย box-shadow: 0 0 0 #4a5568;ย
ย ย ย ย }


ย ย ย ย /* Estado de la Wallet */
ย ย ย ย .wallet-status-details {
ย ย ย ย ย ย margin-top: 15px;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย background-color: #374151; /* Gris medio oscuro */
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย text-align: left;ย
ย ย ย ย ย ย border-left: 4px solid var(--secondary-color);
ย ย ย ย ย ย color: var(--text-light);
ย ย ย ย ย ย display: block;ย
ย ย ย ย ย ย margin-top: 10px;ย
ย ย ย ย ย ย border: 1px solid #4b5563;
ย ย ย ย }

ย ย ย ย .status-label {
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย color: var(--text-muted);
ย ย ย ย ย ย margin-right: 5px;
ย ย ย ย }

ย ย ย ย .status-value {
ย ย ย ย ย ย font-weight: 400;
ย ย ย ย ย ย word-break: break-all;
ย ย ย ย ย ย color: var(--text-light);ย
ย ย ย ย }

ย ย ย ย .status-value.connected {
ย ย ย ย ย ย color: var(--success-color);
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย }

ย ย ย ย .status-value.disconnected {
ย ย ย ย ย ย color: var(--error-color);
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย }

ย ย ย ย /* OCULTAR la lรญnea de la red de contrato (ya que el usuario no la solicitรณ) */
ย ย ย ย .network-line {
ย ย ย ย ย ย display: none;
ย ย ย ย }

ย ย ย ย .truncate {
ย ย ย ย ย ย overflow: hidden;
ย ย ย ย ย ย white-space: nowrap;
ย ย ย ย ย ย text-overflow: ellipsis;
ย ย ย ย }

ย ย ย ย /* Airdrop Stats */
ย ย ย ย .airdrop-section {
ย ย ย ย ย ย text-align: center;
ย ย ย ย }

ย ย ย ย .airdrop-title {
ย ย ย ย ย ย color: var(--secondary-color) !important;
ย ย ย ย }

ย ย ย ย .airdrop-grid {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย /* Usamos un layout mรกs flexible para evitar desbordes en mรณviles.
ย ย ย ย ย ย ย* Permite que las columnas se adapten manteniendo un mรญnimo de 140px. */
ย ย ย ย ย ย grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* <-- CORRECCIรN CLAVE */
ย ย ย ย ย ย gap: 15px;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย text-align: center;
ย ย ย ย }

ย ย ย ย .airdrop-stat {
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย /* Degradado sutil para las estadรญsticas */
ย ย ย ย ย ย background: linear-gradient(180deg, #374151 0%, #2d3748 100%);
ย ย ย ย ย ย border-radius: 12px;
ย ย ย ย ย ย border: 1px solid #4b5563;
ย ย ย ย ย ย box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
ย ย ย ย ย ย /* CORRECCIรN CLAVE: Permite que el texto largo (como el estado) se rompa */
ย ย ย ย ย ย overflow-wrap: break-word; 
ย ย ย ย ย ย word-break: break-word; 
ย ย ย ย }

ย ย ย ย .stat-label {
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย color: var(--text-muted);
ย ย ย ย ย ย margin-bottom: 5px;
ย ย ย ย }

ย ย ย ย .stat-value {
ย ย ย ย ย ย font-size: 1.75rem;
ย ย ย ย ย ย font-weight: 700;
ย ย ย ย ย ย color: var(--secondary-color); /* Celeste de acento */
ย ย ย ย ย ย text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Uso de clases especรญficas para el estado de reclamo */
ย ย ย ย .claimed {
ย ย ย ย ย ย color: var(--success-color);
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย }

ย ย ย ย .pending {
ย ย ย ย ย ย color: var(--secondary-color);
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย }
        
        /* Clase especial para el mensaje de pool agotada */
        .exhausted {
            color: var(--error-color);
            font-weight: 700;
            font-size: 1rem;
        }

ย ย ย ย /* Mensajes de Estado */
ย ย ย ย .status-message {
ย ย ย ย ย ย margin-top: 5px;
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย background-color: transparent;ย
ย ย ย ย ย ย color: var(--text-light);
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย min-height: 20px;ย
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย border: none;ย
ย ย ย ย ย ย /* Asegura que los mensajes de estado tambiรฉn se envuelvan */
            overflow-wrap: break-word; 
ย ย ย ย ย ย word-break: break-word; 
ย ย ย ย }

ย ย ย ย /* About Section */
ย ย ย ย .about-section h3 {
ย ย ย ย ย ย ยcolor: var(--primary-color);
ย ย ย ย ย ย ยfont-size: 1.2rem;
ย ย ย ย ย ย ยfont-weight: 700;
ย ย ย ย ย ย ยmargin-bottom: 10px;
ย ย ย ย }

ย ย ย ย .about-text {
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย line-height: 1.6;
ย ย ย ย ย ย color: var(--text-muted);
ย ย ย ย }

ย ย ย ย /* Footer */
ย ย ย ย .footer {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย padding-top: 15px;
ย ย ย ย ย ย border-top: 1px solid #374151;
ย ย ย ย ย ย font-size: 0.8rem;
ย ย ย ย ย ย color: var(--text-muted);
ย ย ย ย }
ย ย </style>
</head>

<body>
ย ย ย ย <div class="container">ย

ย ย ย ย ย ย ย ย <header class="header">
ย ย ย ย ย ย <div class="logo-container">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <img src="foqi-ogg.png" alt="foqi-ogg.png" class="logo">
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <h1>FOQI Coin (<span class="token-symbol">$FOQI</span>)</h1>
ย ย ย ย ย ย <p class="slogan">
ย ย ย ย ย ย ย ย Naturaleza y tecnologรญa juntos por un futuro mejor.
ย ย ย ย ย ย </p>
ย ย ย ย </header>

ย ย ย ย ย ย ย ย <section class="section">
ย ย ย ย ย ย <h2>๐ Conexiรณn y Estado</h2>

ย ย ย ย ย ย <button id="connectButton" class="connect-button">
ย ย ย ย ย ย ย ย Conectar Wallet
ย ย ย ย ย ย </button>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="wallet-status-details">
ย ย ย ย ย ย ย ย <p class="truncate">
ย ย ย ย ย ย ย ย ย ย <span class="status-label">Wallet:</span>
ย ย ย ย ย ย ย ย ย ย <span id="walletAddress" class="status-value disconnected">No conectado</span>
ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="network-line">
ย ย ย ย ย ย ย ย ย ย <span class="status-label">Red:</span>
ย ย ย ย ย ย ย ย ย ย <span id="networkStatus" class="status-value disconnected">Desconectado</span>
ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย </div>
ย ย ย ย </section>

ย ย ย ย ย ย ย ย <section class="section airdrop-section">
ย ย ย ย ย ย <h2 class="airdrop-title">
ย ย ย ย ย ย ย ย ๐ง Reclama tu Airdrop FOQI
ย ย ย ย ย ย </h2>

ย ย ย ย ย ย <div class="airdrop-grid">
ย ย ย ย ย ย ย ย <div class="airdrop-stat">
ย ย ย ย ย ย ย ย ย ย <p class="stat-label">Airdrop restante</p>
ย ย ย ย ย ย ย ย ย ย <p id="airdropRemaining" class="stat-value">-</p>
ย ย ย ย ย ย ย ย ย ย <p class="stat-unit">FOQI</p>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="airdrop-stat">
ย ย ย ย ย ย ย ย ย ย <p class="stat-label">Tu estado de reclamo</p>
ย ย ย ย ย ย ย ย ย ย <p id="claimedStatus" class="pending">-</p>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <button id="airdropButton" disabled class="airdrop-button disabled">
ย ย ย ย ย ย ย ย Reclamar Airdrop
ย ย ย ย ย ย </button>
ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <button id="addTokenButton" class="add-token-button">
ย ย ย ย ย ย ย ย โ Aรฑadir $FOQI a Wallet
ย ย ย ย ย ย </button>


ย ย ย ย ย ย <p id="status" class="status-message"></p>
ย ย ย ย </section>

ย ย ย ย ย ย ย ย <section class="section about-section">
ย ย ย ย ย ย <h3>๐ฑ Sobre FOQI Coin</h3>
ย ย ย ย ย ย <p class="about-text">
ย ย ย ย ย ย ย ย FOQI Coin es una moneda creada para impulsar una economรญa responsable,
ย ย ย ย ย ย ย ย donde la tecnologรญa blockchain se une a la conservaciรณn ambiental
ย ย ย ย ย ย ย ย y al apoyo de proyectos comunitarios.
ย ย ย ย ย ย </p>
ย ย ย ย </section>

ย ย ย ย ย ย ย ย <footer class="footer">
ย ย ย ย ย ย <p>ยฉ 2025 FOQI Coin | $FOQI</p>
ย ย ย ย </footer>
ย ย </div>

ย ย <script>
ย ย ย ย // --- LรGICA JAVASCRIPT ---
ย ย ย ย const connectButton = document.getElementById("connectButton");
ย ย ย ย const walletAddressEl = document.getElementById("walletAddress");
ย ย ย ย const networkStatusEl = document.getElementById("networkStatus");
ย ย ย ย const airdropButton = document.getElementById("airdropButton");
ย ย ย ย const addTokenButton = document.getElementById("addTokenButton"); // Nuevo botรณn
ย ย ย ย const statusEl = document.getElementById("status");
ย ย ย ย const airdropRemainingEl = document.getElementById("airdropRemaining");
ย ย ย ย const claimedStatusEl = document.getElementById("claimedStatus");

ย ย ย ย // --- DIRECCIรN DEL CONTRATO DE EJEMPLO Y ABI ---
ย ย ย ย // (Asegรบrate de reemplazar esta direcciรณn con el contrato real en la red final)
ย ย ย ย const CONTRACT_ADDRESS = "0x29c2EaC23C28456DBBCB68F5cfcdE94350A27660";ย
ย ย ย ยย
ย ย ย ย const ABI = [
ย ย ย ย ย ย "function claimAirdrop() external",
ย ย ย ย ย ย "function hasClaimed(address) view returns (bool)",
ย ย ย ย ย ย "function airdropRemaining() view returns (uint256)"
ย ย ย ย ];

ย ย ย ย let provider, signer, contract;
ย ย ย ย let userAddress = null;
        let isAirdropExhausted = false; // Nueva variable de estado

ย ย ย ย /**
ย ย ย ย ย* Habilita o deshabilita el botรณn de Airdrop y actualiza su texto y estilo.
ย ย ย ย ย*/
ย ย ย ย function setAirdropButtonState(enable, text = "Reclamar Airdrop") {
ย ย ย ย ย ย airdropButton.disabled = !enable || isAirdropExhausted;
ย ย ย ย ย ย airdropButton.textContent = isAirdropExhausted ? "Airdrop Agotado ๐ซ" : text;

ย ย ย ย ย ย // Se usan las clases del CSS personalizado para los estilos
ย ย ย ย ย ย if (enable && !isAirdropExhausted) {
ย ย ย ย ย ย ย ย airdropButton.classList.remove("disabled");
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย airdropButton.classList.add("disabled");
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /**
ย ย ย ย ย* Inicializa el proveedor de Ethers (MetaMask).
ย ย ย ย ย*/
ย ย ย ย async function initProvider() {
ย ย ย ย ย ย if (!window.ethereum) {
ย ย ย ย ย ย ย ย statusEl.textContent = "โ MetaMask o Wallet Connect no detectado. Instala una extensiรณn.";
ย ย ย ย ย ย ย ย networkStatusEl.textContent = "โ MetaMask no detectado.";
ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย }
ย ย ย ย ย ย // Usa BrowserProvider para interactuar con la billetera inyectada
ย ย ย ย ย ย provider = new ethers.BrowserProvider(window.ethereum);
ย ย ย ย ย ย return true;
ย ย ย ย }

ย ย ย ย /**
ย ย ย ย ย* Evento al hacer clic en Conectar Wallet.
ย ย ย ย ย*/
ย ย ย ย connectButton.onclick = async () => {
ย ย ย ย ย ย const ok = await initProvider();
ย ย ย ย ย ย if (!ok) return;
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Solicita las cuentas del usuario
ย ย ย ย ย ย ย ย await window.ethereum.request({ method: "eth_requestAccounts" });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย signer = await provider.getSigner();
ย ย ย ย ย ย ย ย userAddress = await signer.getAddress();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const network = await provider.getNetwork();

ย ย ย ย ย ย ย ย // Actualiza el estado de la wallet en la interfaz
ย ย ย ย ย ย ย ย walletAddressEl.textContent = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
ย ย ย ย ย ย ย ย walletAddressEl.classList.add("connected");
ย ย ย ย ย ย ย ย walletAddressEl.classList.remove("disconnected");
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย networkStatusEl.textContent = `${network.name} (ChainID: ${network.chainId})`;
ย ย ย ย ย ย ย ย networkStatusEl.classList.add("connected");
ย ย ย ย ย ย ย ย networkStatusEl.classList.remove("disconnected");

ย ย ย ย ย ย ย ย // Inicializa el contrato con el Signer para enviar transacciones
ย ย ย ย ย ย ย ย contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

ย ย ย ย ย ย ย ย await refreshAirdropInfo();
ย ย ย ย ย ย ย ย await refreshClaimStatus();

ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย // Solo muestra el error al usuario, sin usar console.error
ย ย ย ย ย ย ย ย statusEl.textContent = "โ Error al conectar wallet. Asegรบrate de tener MetaMask desbloqueado.";
ย ย ย ย ย ย }
ย ย ย ย };
ย ย ย ยย
ย ย ย ย /**
ย ย ย ย ย* NUEVA FUNCIรN: Aรฑadir el token a MetaMask.
ย ย ย ย ย*/
ย ย ย ย addTokenButton.onclick = async () => {
ย ย ย ย ย ย if (!window.ethereum) {
ย ย ย ย ย ย ย ย statusEl.textContent = "โ MetaMask no detectado.";
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // El mรฉtodo eth_requestAccounts garantiza que MetaMask estรฉ abierto y conectado
ย ย ย ย ย ย ย ย await window.ethereum.request({ method: "eth_requestAccounts" });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const wasAdded = await window.ethereum.request({
ย ย ย ย ย ย ย ย ย ย method: 'wallet_watchAsset',
ย ย ย ย ย ย ย ย ย ย params: {
ย ย ย ย ย ย ย ย ย ย ย ย type: 'ERC20',
ย ย ย ย ย ย ย ย ย ย ย ย options: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย address: CONTRACT_ADDRESS, // Direcciรณn del contrato FOQI
ย ย ย ย ย ย ย ย ย ย ย ย ย ย symbol: 'FOQI', // Sรญmbolo del token
ย ย ย ย ย ย ย ย ย ย ย ย ย ย decimals: 18, // Decimales
ย ย ย ย ย ย ย ย ย ย ย ย ย ย // image: 'URL_A_TU_IMAGEN_DE_TOKEN', // Opcional: URL de la imagen
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย if (wasAdded) {
ย ย ย ย ย ย ย ย ย ย statusEl.textContent = "โ ยกToken $FOQI aรฑadido con รฉxito a tu Wallet!";
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย statusEl.textContent = "โน๏ธ El usuario cancelรณ la adiciรณn del token.";
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย statusEl.textContent = "โ Fallรณ al aรฑadir el token. Intenta manualmente.";
ย ย ย ย ย ย }
ย ย ย ย };


ย ย ย ย /**
ย ย ย ย ย* Actualiza el contador de FOQI restante en el Airdrop.
ย ย ย ย ย*/
ย ย ย ย async function refreshAirdropInfo() {
ย ย ย ย ย ย if (!provider) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย provider = ethers.getDefaultProvider("mainnet"); // Asumiendo mainnet, ajusta si es otra red
ย ย ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย ย ย airdropRemainingEl.textContent = "N/A";
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Usamos el provider para las lecturas de solo vista
ย ย ย ย ย ย ย ย const readContract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);ย
ย ย ย ย ย ย ย ย const remainingWei = await readContract.airdropRemaining();
ย ย ย ย ย ย ย ย // Asume 18 decimales (tรญpico de tokens ERC20)
ย ย ย ย ย ย ย ย const remaining = ethers.formatUnits(remainingWei, 18);ย
                const remainingValue = Number(remaining);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย airdropRemainingEl.textContent = remainingValue.toLocaleString(undefined, { maximumFractionDigits: 2 });
                
                // Si lo que queda es 0 o muy cerca de 0, marcamos la pool como agotada.
                if (remainingValue < 0.01) {
                    isAirdropExhausted = true;
                    // Tambiรฉn podemos actualizar el mensaje de estado si no hay otro mensaje importante
                    if (statusEl.textContent.trim() === "" || statusEl.textContent.includes("Reclamo exitoso")) {
                         statusEl.textContent = "โ๏ธ ยกEl Airdrop ha sido agotado! ๐ซ";
                         statusEl.classList.add("exhausted");
                    }
                } else {
                    isAirdropExhausted = false;
                    statusEl.classList.remove("exhausted");
                }

                // Asegura que el estado del botรณn se actualice si la pool se agotรณ
                if (userAddress) {
                    refreshClaimStatus(); 
                }

ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย airdropRemainingEl.textContent = "Error";
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /**
ย ย ย ย ย* Actualiza el estado de reclamo del usuario.
ย ย ย ย ย*/
ย ย ย ย async function refreshClaimStatus() {
ย ย ย ย ย ย // Requiere que la billetera estรฉ conectada
ย ย ย ย ย ย if (!contract || !userAddress) {
ย ย ย ย ย ย ย ย claimedStatusEl.textContent = "Descon.";
ย ย ย ย ย ย ย ย claimedStatusEl.classList.remove("claimed");
ย ย ย ย ย ย ย ย claimedStatusEl.classList.add("pending");
ย ย ย ย ย ย ย ย setAirdropButtonState(false, "Conectar Wallet");
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const didClaim = await contract.hasClaimed(userAddress);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Actualizaciรณn de clases para el nuevo diseรฑo (Verde para reclamado)
ย ย ย ย ย ย ย ย if (didClaim) {
ย ย ย ย ย ย ย ย ย ย claimedStatusEl.textContent = "โ Ya reclamaste";
ย ย ย ย ย ย ย ย ย ย claimedStatusEl.classList.add("claimed");
ย ย ย ย ย ย ย ย ย ย claimedStatusEl.classList.remove("pending");
ย ย ย ย ย ย ย ย ย ย setAirdropButtonState(false, "Reclamo completado");
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย claimedStatusEl.textContent = "โณ Pendiente";
ย ย ย ย ย ย ย ย ย ย claimedStatusEl.classList.remove("claimed");
ย ย ย ย ย ย ย ย ย ย claimedStatusEl.classList.add("pending");
ย ย ย ย ย ย ย ย ย ย // Asegura que se desactive si la pool estรก agotada, incluso si no ha reclamado
ย ย ย ย ย ย ย ย ย ย setAirdropButtonState(!isAirdropExhausted);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย // Si falla la lectura, no hacemos nada y dejamos el estado actual
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /**
ย ย ย ย ย* Evento al hacer clic en Reclamar Airdrop.
ย ย ย ย ย*/
ย ย ย ย airdropButton.onclick = async () => {
ย ย ย ย ย ย if (!contract) {
ย ย ย ย ย ย ย ย statusEl.textContent = "๐จ Por favor, conecta tu wallet.";
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
            
            // Verificaciรณn previa de pool agotada
            if (isAirdropExhausted) {
                statusEl.textContent = "โ๏ธ ยกEl Airdrop estรก agotado! No puedes reclamar.";
                statusEl.classList.add("exhausted");
                return;
            }

ย ย ย ย ย ย setAirdropButtonState(false, "Procesando...");
            statusEl.classList.remove("exhausted");
ย ย ย ย ย ย statusEl.textContent = "โ๏ธ Enviando transacciรณn... Por favor, aprueba en tu wallet.";
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Envรญa la transacciรณn
ย ย ย ย ย ย ย ย const tx = await contract.claimAirdrop();
ย ย ย ย ย ย ย ย statusEl.textContent = "๐ Transacciรณn enviada. Hash: " + tx.hash.slice(0, 10) + "... Esperando confirmaciรณn...";
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Espera a que la transacciรณn se mine
ย ย ย ย ย ย ย ย await tx.wait();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย statusEl.textContent = "โ Reclamo exitoso. Los tokens han sido enviados.";
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Actualiza los estados
ย ย ย ย ย ย ย ย await refreshAirdropInfo();
ย ย ย ย ย ย ย ย await refreshClaimStatus();
ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย let errorMsg = "โ Error desconocido al reclamar.";
ย ย ย ย ย ย ย ย statusEl.classList.remove("exhausted"); // Limpia la clase de agotado por si acaso
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // 4001: Usuario rechazรณ la transacciรณn
ย ย ย ย ย ย ย ย if (err.code === 4001) {
ย ย ย ย ย ย ย ย ย ย errorMsg = "โ Transacciรณn rechazada por el usuario.";
ย ย ย ย ย ย ย ย } else if (err.reason) {
ย ย ย ย ย ย ย ย ย ย // Manejo de errores de EVM/Contrato (Revert)
ย ย ย ย ย ย ย ย ย ย if (err.reason.includes("Already claimed")) {
ย ย ย ย ย ย ย ย ย ย ย ย ยerrorMsg = "โ Ya reclamaste el airdrop.";
ย ย ย ย ย ย ย ย ย ย } else if (err.reason.includes("Airdrop pool exhausted")) {
ย ย ย ย ย ย ย ย ย ย ย ย ยerrorMsg = "โ๏ธ ยกEl Airdrop ha sido agotado! ๐ซ"; // <-- Mensaje especรญfico para pool agotada
                        statusEl.classList.add("exhausted"); // Aplica el estilo de agotado
                        isAirdropExhausted = true;
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย errorMsg = `โ Fallรณ la transacciรณn: ${err.reason.slice(0, 50)}...`; // Trunca el mensaje de error largo
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย errorMsg = `โ Error RPC/Desconocido. Intenta de nuevo.`;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย statusEl.textContent = errorMsg;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Volvemos a habilitar el botรณn si no fue un reclamo completado
ย ย ย ย ย ย ย ย refreshClaimStatus();ย
ย ย ย ย ย ย }
ย ย ย ย };

ย ย ย ย // Escucha cambios de cuenta y red en MetaMask para recargar la app
ย ย ย ย if (window.ethereum) {
ย ย ย ย ย ย window.ethereum.on("accountsChanged", () => location.reload());
ย ย ย ย ย ย window.ethereum.on("chainChanged", () => location.reload());
ย ย ย ย }

ย ย ย ย // Auto-refresh del Airdrop restante cada 30 segundos
ย ย ย ย setInterval(() => {
ย ย ย ย ย ย refreshAirdropInfo();
ย ย ย ย }, 30000);ย
ย ย ย ยย
ย ย ย ย // Carga inicial de la informaciรณn del Airdrop
ย ย ย ย refreshAirdropInfo();ย
ย ย ย ยย
ย ย </script>
</body>

</html>
